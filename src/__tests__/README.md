# Stilya アプリテスト計画

このドキュメントは、Day 37の機能テスト実装で作成された各種テストについて説明しています。

## テスト概要

Stilya アプリでは以下の3種類のテストを実装しています：

1. **ユーザーフロー統合テスト**: ユーザーが実際に使用する主要なフローをエンドツーエンドでテスト
2. **エッジケーステスト**: エラー処理やエラー状態などの例外的なケースをテスト
3. **デバイス互換性テスト**: 異なるデバイスサイズや設定でのUIの表示を検証

## 1. ユーザーフロー統合テスト

`src/__tests__/integration/userFlows.test.tsx`

以下の主要なユーザーフローをテストしています：

- **ログイン〜オンボーディング〜スワイプフロー**: ユーザーがログインし、初期設定を行い、商品スワイプ画面に至るまでの一連のフロー
- **商品詳細画面遷移と戻る操作**: 商品カードから詳細画面への遷移と戻る操作
- **タブ間の移動**: スワイプ画面からおすすめタブへの移動
- **プロフィール画面とログアウト**: マイページタブへの移動とログアウト操作

### テスト実行方法

```bash
npm test -- --testPathPattern=userFlows
```

## 2. エッジケーステスト

`src/__tests__/edge-cases/edgeCases.test.tsx`

以下のエッジケースをテストしています：

### ネットワーク接続テスト
- オフライン時のオフライン通知表示
- オフライン時のスワイプ機能無効化
- オフライン時のおすすめ商品取得エラー処理

### 入力バリデーションテスト
- 無効なメールアドレス形式の処理
- 短すぎるパスワードの処理

### エラーハンドリングテスト
- 認証エラーの処理
- 商品取得エラーの処理

### テスト実行方法

```bash
npm test -- --testPathPattern=edgeCases
```

## 3. デバイス互換性テスト

`src/__tests__/device-compatibility/deviceCompatibility.test.tsx`

以下のデバイス互換性をテストしています：

### SwipeCardコンポーネント
- 小型画面デバイス（iPhone SE）での表示
- 大型画面デバイス（iPhone 14 Plus）での表示
- タブレット（iPad）での表示
- 横向き（ランドスケープ）での表示
- 大きいフォントサイズでの表示
- RTLレイアウト（右から左への表示）での表示

### Buttonコンポーネント
- 異なる画面サイズでのボタン表示の検証
- フォントスケーリングに応じたサイズ調整の検証

### テスト実行方法

```bash
npm test -- --testPathPattern=deviceCompatibility
```

## デバイステストユーティリティ

`src/__tests__/utils/deviceTestUtils.ts`

異なるデバイス設定をモックするためのユーティリティ関数を提供しています：

- `mockDeviceShape()`: 画面サイズ、プラットフォーム、設定などをモック
- `resetDeviceMock()`: モックをリセット
- `mockLandscapeOrientation()`: 横向き画面をモック
- `testOnMultipleDevices()`: 複数デバイスでのテストを実行

### サポートしているデバイスプリセット

- iPhones: iPhone SE, iPhone 13 Mini, iPhone 14 Plus, iPhone 14 Pro Max
- Androids: 小型, 中型, 大型
- Tablets: iPad, Android タブレット
- アクセシビリティ設定: 大きいフォント, RTL, スクリーンリーダー

## 今後のテスト拡張案

1. **パフォーマンステスト**
   - レンダリング速度の検証
   - メモリ使用量の監視
   - バンドルサイズの最適化

2. **アクセシビリティテスト**
   - スクリーンリーダー対応の検証
   - コントラスト比の確認
   - タッチターゲットサイズの検証

3. **セキュリティテスト**
   - データ保存のセキュリティ
   - トークン管理の安全性
   - API通信の保護

4. **バックエンド統合テスト**
   - Supabase APIとの統合テスト
   - リアルタイムデータ同期のテスト
   - オフライン・オンライン遷移時のデータ整合性

## テスト実行環境

- Jest + React Native Testing Library
- Jest Matchers (toBeDisabled, toMatchSnapshot など)
- Mock機能 (Context, API, Native Modules)
