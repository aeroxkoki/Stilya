name: Unified Product Sync - Phase 3 (50-60 Brands)

on:
  schedule:
    # ãƒ¡ã‚¤ãƒ³åŒæœŸ: æ¯Žæ—¥åˆå‰2æ™‚ï¼ˆJSTï¼‰
    - cron: '0 17 * * *'  # UTC 17:00 = JST 2:00
    # ã‚µãƒ–åŒæœŸ: æ¯Žæ—¥åˆå¾Œ2æ™‚ï¼ˆJSTï¼‰- è»½é‡æ›´æ–°ç”¨
    - cron: '0 5 * * *'   # UTC 5:00 = JST 14:00
  workflow_dispatch:
    inputs:
      sync_mode:
        description: 'Sync mode'
        required: false
        default: 'full'
        type: choice
        options:
          - full         # ãƒ•ãƒ«åŒæœŸï¼ˆ50-60ãƒ–ãƒ©ãƒ³ãƒ‰ã€50,000+å•†å“ï¼‰
          - extended     # æ‹¡å¼µMVPï¼ˆ30ãƒ–ãƒ©ãƒ³ãƒ‰ï¼‰
          - mvp          # MVPå„ªå…ˆãƒ–ãƒ©ãƒ³ãƒ‰ã®ã¿ï¼ˆ5ãƒ–ãƒ©ãƒ³ãƒ‰ï¼‰
          - seasonal     # å­£ç¯€å•†å“å„ªå…ˆ
          - age_targeted # å¹´ä»£åˆ¥æœ€é©åŒ–
          - maintenance  # ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã®ã¿
          - test         # ãƒ†ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰ï¼ˆãƒ‰ãƒ©ã‚¤ãƒ©ãƒ³ï¼‰
      
      priority_filter:
        description: 'Priority filter (0-7, or all)'
        required: false
        default: 'all'
        type: choice
        options:
          - all
          - '0'  # ã‚¹ãƒ¼ãƒ‘ãƒ¼å„ªå…ˆï¼ˆUNIQLO, GU, ç„¡å°è‰¯å“ï¼‰
          - '1'  # ãƒ•ã‚¡ã‚¹ãƒˆãƒ•ã‚¡ãƒƒã‚·ãƒ§ãƒ³
          - '2'  # äººæ°—ECãƒ–ãƒ©ãƒ³ãƒ‰
          - '3'  # ã‚»ãƒ¬ã‚¯ãƒˆã‚·ãƒ§ãƒƒãƒ—
          - '4'  # ãƒ©ã‚¤ãƒ•ã‚¹ã‚¿ã‚¤ãƒ«
          - '5'  # å¹´é½¢å±¤ç‰¹åŒ–
          - '6'  # ãƒˆãƒ¬ãƒ³ãƒ‰ãƒ»å€‹æ€§æ´¾
          - '7'  # ç™¾è²¨åº—ãƒ»ãƒã‚¤ãƒ–ãƒ©ãƒ³ãƒ‰
      
      target_age_group:
        description: 'Target age group'
        required: false
        default: 'all'
        type: choice
        options:
          - all
          - '20-24'  # 20ä»£å‰åŠ
          - '25-29'  # 20ä»£å¾ŒåŠ
          - '30-34'  # 30ä»£å‰åŠ
          - '35-39'  # 30ä»£å¾ŒåŠ
          - '40-45'  # 40ä»£
      
      target_brands:
        description: 'Specific brands only (comma-separated)'
        required: false
        type: string
      
      product_limit:
        description: 'Product limit per brand'
        required: false
        default: 'progressive'
        type: choice
        options:
          - progressive  # æ®µéšŽçš„å¢—åŠ ï¼ˆæŽ¨å¥¨ï¼‰
          - minimal      # æœ€å°é™ï¼ˆ100-500ï¼‰
          - standard     # æ¨™æº–ï¼ˆ500-2000ï¼‰
          - maximum      # æœ€å¤§ï¼ˆ2000-10000ï¼‰
      
      enable_features:
        description: 'Enable features'
        required: false
        default: 'all'
        type: choice
        options:
          - all          # å…¨æ©Ÿèƒ½æœ‰åŠ¹
          - scoring      # ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°ã®ã¿
          - seasonal     # å­£ç¯€å„ªå…ˆåº¦ã®ã¿
          - ml_tags      # æ©Ÿæ¢°å­¦ç¿’ã‚¿ã‚°ã®ã¿
          - age_analysis # å¹´ä»£åˆ†æžã®ã¿
          - basic        # åŸºæœ¬æ©Ÿèƒ½ã®ã¿
      
      maintenance_tasks:
        description: 'Maintenance tasks'
        required: false
        default: 'all'
        type: choice
        options:
          - all          # å…¨ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹
          - cleanup      # å¤ã„å•†å“å‰Šé™¤
          - optimize     # DBæœ€é©åŒ–
          - stats        # çµ±è¨ˆæ›´æ–°
          - rotation     # å•†å“ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³
          - none         # ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ãªã—
      
      dry_run:
        description: 'Dry run mode (no DB changes)'
        required: false
        default: 'false'
        type: choice
        options:
          - 'true'
          - 'false'

jobs:
  unified-sync:
    name: Unified Product Sync
    runs-on: ubuntu-latest
    timeout-minutes: 180  # 3æ™‚é–“ã®ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆï¼ˆå¤§è¦æ¨¡åŒæœŸå¯¾å¿œï¼‰
    
    steps:
      - name: ðŸ“¦ Checkout repository
        uses: actions/checkout@v4

      - name: ðŸ—ï¸ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'npm'

      - name: ðŸ“¥ Install dependencies
        run: |
          npm ci
          npm install --save-prod dotenv @supabase/supabase-js axios

      - name: ðŸ” Pre-sync environment check
        id: env_check
        run: |
          echo "## ðŸ” Environment Check" >> $GITHUB_STEP_SUMMARY
          echo "- Date: $(date '+%Y-%m-%d %H:%M:%S JST')" >> $GITHUB_STEP_SUMMARY
          echo "- Sync mode: ${{ github.event.inputs.sync_mode || 'full' }}" >> $GITHUB_STEP_SUMMARY
          echo "- Priority filter: ${{ github.event.inputs.priority_filter || 'all' }}" >> $GITHUB_STEP_SUMMARY
          echo "- Target age: ${{ github.event.inputs.target_age_group || 'all' }}" >> $GITHUB_STEP_SUMMARY
          echo "- Product limit: ${{ github.event.inputs.product_limit || 'progressive' }}" >> $GITHUB_STEP_SUMMARY
          echo "- Features: ${{ github.event.inputs.enable_features || 'all' }}" >> $GITHUB_STEP_SUMMARY
          echo "- Dry run: ${{ github.event.inputs.dry_run || 'false' }}" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          
          # å­£ç¯€åˆ¤å®š
          MONTH=$(date +%m)
          if [[ $MONTH -ge 3 && $MONTH -le 5 ]]; then
            SEASON="æ˜¥ ðŸŒ¸"
            echo "season=spring" >> $GITHUB_ENV
          elif [[ $MONTH -ge 6 && $MONTH -le 8 ]]; then
            SEASON="å¤ â˜€ï¸"
            echo "season=summer" >> $GITHUB_ENV
          elif [[ $MONTH -ge 9 && $MONTH -le 11 ]]; then
            SEASON="ç§‹ ðŸ"
            echo "season=autumn" >> $GITHUB_ENV
          else
            SEASON="å†¬ â„ï¸"
            echo "season=winter" >> $GITHUB_ENV
          fi
          echo "- Current season: $SEASON" >> $GITHUB_STEP_SUMMARY
          
          # å¿…é ˆç’°å¢ƒå¤‰æ•°ãƒã‚§ãƒƒã‚¯
          if [ -z "${{ secrets.SUPABASE_URL }}" ]; then
            echo "âŒ SUPABASE_URL is not set" >> $GITHUB_STEP_SUMMARY
            exit 1
          fi
          
          if [ -z "${{ secrets.RAKUTEN_APP_ID }}" ]; then
            echo "âŒ RAKUTEN_APP_ID is not set" >> $GITHUB_STEP_SUMMARY
            exit 1
          fi
          
          echo "âœ… All required environment variables are set" >> $GITHUB_STEP_SUMMARY

      - name: ðŸ—„ï¸ Supabase free tier monitoring
        id: capacity_check
        run: |
          echo "## ðŸ—„ï¸ Supabase Free Tier Monitoring" >> $GITHUB_STEP_SUMMARY
          
          # ç„¡æ–™æž ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œ
          node scripts/monitoring/supabase-free-tier-monitor.js >> monitoring_report.txt 2>&1 || true
          
          if [ -f monitoring_report.txt ]; then
            # ãƒ¬ãƒãƒ¼ãƒˆã®è¦ç´„ã‚’æŠ½å‡º
            echo "### ðŸ“Š Current Usage:" >> $GITHUB_STEP_SUMMARY
            grep -E "ç·å•†å“æ•°:|ä½¿ç”¨çŽ‡:|æŽ¨å®šä½¿ç”¨é‡:" monitoring_report.txt | head -5 >> $GITHUB_STEP_SUMMARY || true
            echo "" >> $GITHUB_STEP_SUMMARY
            
            # æœ€é©åŒ–ææ¡ˆã‚’æŠ½å‡º
            echo "### ðŸ’¡ Optimization Suggestions:" >> $GITHUB_STEP_SUMMARY
            awk '/æœ€é©åŒ–ææ¡ˆ:/{flag=1} /=====/{flag=0} flag' monitoring_report.txt | grep -E "âœ…|âš ï¸|ðŸš¨|â„¹ï¸" | head -5 >> $GITHUB_STEP_SUMMARY || true
          fi
          
          # å®¹é‡ãƒã‚§ãƒƒã‚¯ï¼ˆ45,000ä»¶ã§è­¦å‘Šã€ã“ã‚Œã¯500MBã®ç´„90%ç›¸å½“ï¼‰
          TOTAL_COUNT=$(grep -oP 'ç·å•†å“æ•°: \K[\d,]+' monitoring_report.txt | tr -d ',' || echo "0")
          USAGE_PERCENT=$(grep -oP 'ä½¿ç”¨çŽ‡: \K[\d.]+' monitoring_report.txt || echo "0")
          
          # ä½¿ç”¨çŽ‡ãŒ90%ä»¥ä¸Šã®å ´åˆã¯ã‚¨ãƒ©ãƒ¼
          if (( $(echo "$USAGE_PERCENT > 90" | bc -l) )); then
            echo "âŒ Database is at critical capacity (${USAGE_PERCENT}%)" >> $GITHUB_STEP_SUMMARY
            exit 1
          elif (( $(echo "$USAGE_PERCENT > 80" | bc -l) )); then
            echo "âš ï¸ Database usage is high (${USAGE_PERCENT}%)" >> $GITHUB_STEP_SUMMARY
            echo "capacity_warning=true" >> $GITHUB_ENV
          else
            echo "âœ… Database capacity is healthy (${USAGE_PERCENT}%)" >> $GITHUB_STEP_SUMMARY
          fi
        env:
          EXPO_PUBLIC_SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
          EXPO_PUBLIC_SUPABASE_ANON_KEY: ${{ secrets.SUPABASE_ANON_KEY }}

      - name: ðŸŽ¯ Execute unified sync
        id: sync
        run: |
          echo "## ðŸŽ¯ Unified Product Sync Execution" >> $GITHUB_STEP_SUMMARY
          
          # ç’°å¢ƒå¤‰æ•°ã®è¨­å®š
          export SYNC_MODE="${{ github.event.inputs.sync_mode || 'full' }}"
          export PRIORITY_FILTER="${{ github.event.inputs.priority_filter || 'all' }}"
          export TARGET_AGE="${{ github.event.inputs.target_age_group || 'all' }}"
          export TARGET_BRANDS="${{ github.event.inputs.target_brands || '' }}"
          export PRODUCT_LIMIT="${{ github.event.inputs.product_limit || 'progressive' }}"
          export ENABLE_FEATURES="${{ github.event.inputs.enable_features || 'all' }}"
          export DRY_RUN="${{ github.event.inputs.dry_run || 'false' }}"
          export CURRENT_SEASON="${{ env.season }}"
          export CAPACITY_WARNING="${{ env.capacity_warning || 'false' }}"
          
          # æ™‚åˆ»ã«ã‚ˆã‚‹ãƒ¢ãƒ¼ãƒ‰è‡ªå‹•èª¿æ•´
          HOUR=$(date +%H)
          if [ "$GITHUB_EVENT_NAME" == "schedule" ]; then
            if [ "$HOUR" -eq 17 ]; then  # UTC 17:00 = JST 2:00
              echo "- Auto mode: Full sync (night schedule)" >> $GITHUB_STEP_SUMMARY
              export SYNC_MODE="full"
            else
              echo "- Auto mode: MVP sync (day schedule)" >> $GITHUB_STEP_SUMMARY
              export SYNC_MODE="mvp"
            fi
          fi
          
          # ãƒ‰ãƒ©ã‚¤ãƒ©ãƒ³ãƒ¢ãƒ¼ãƒ‰
          if [ "$DRY_RUN" == "true" ]; then
            echo "ðŸ” Running in DRY RUN mode - no database changes" >> $GITHUB_STEP_SUMMARY
          fi
          
          # åŒæœŸå®Ÿè¡Œ
          echo "### Starting sync with mode: $SYNC_MODE" >> $GITHUB_STEP_SUMMARY
          
          # Phase 3æ‹¡å¼µã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å®Ÿè¡Œï¼ˆé«˜ç”»è³ªç‰ˆï¼‰
          node scripts/sync/unified-phase3-sync-hq.js || echo "Sync completed with warnings"
        env:
          EXPO_PUBLIC_SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
          EXPO_PUBLIC_SUPABASE_ANON_KEY: ${{ secrets.SUPABASE_ANON_KEY }}
          RAKUTEN_APP_ID: ${{ secrets.RAKUTEN_APP_ID }}
          RAKUTEN_AFFILIATE_ID: ${{ secrets.RAKUTEN_AFFILIATE_ID }}
          NODE_ENV: production
        continue-on-error: true

      - name: ðŸ§¹ Post-sync maintenance
        if: github.event.inputs.maintenance_tasks != 'none' && steps.sync.outcome == 'success'
        run: |
          echo "## ðŸ§¹ Maintenance Tasks" >> $GITHUB_STEP_SUMMARY
          
          MAINTENANCE="${{ github.event.inputs.maintenance_tasks || 'all' }}"
          
          # ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã‚¿ã‚¹ã‚¯ã®å®Ÿè¡Œ
          if [[ "$MAINTENANCE" == "all" || "$MAINTENANCE" == "cleanup" ]]; then
            echo "### ðŸ—‘ï¸ Smart Product Deletion" >> $GITHUB_STEP_SUMMARY
            
            # å®¹é‡ãƒ™ãƒ¼ã‚¹ã®å‰Šé™¤åˆ¤æ–­
            USAGE_PERCENT=$(grep -oP 'ä½¿ç”¨çŽ‡: \K[\d.]+' monitoring_report.txt || echo "0")
            if (( $(echo "$USAGE_PERCENT > 60" | bc -l) )); then
              echo "å®¹é‡ä½¿ç”¨çŽ‡ãŒ${USAGE_PERCENT}%ã®ãŸã‚ã€å‰Šé™¤å‡¦ç†ã‚’å®Ÿè¡Œã—ã¾ã™" >> $GITHUB_STEP_SUMMARY
              node scripts/maintenance/smart-deletion-manager.js --dry-run >> deletion_report.txt 2>&1 || true
              
              # ãƒ‰ãƒ©ã‚¤ãƒ©ãƒ³çµæžœã®è¡¨ç¤º
              if [ -f deletion_report.txt ]; then
                echo "#### å‰Šé™¤å€™è£œ:" >> $GITHUB_STEP_SUMMARY
                grep -E "å‰Šé™¤å¯¾è±¡:|å¤ã„å•†å“:|ä½Žå„ªå…ˆåº¦:|å­£ç¯€å¤–ã‚Œ:|éžã‚¢ã‚¯ãƒ†ã‚£ãƒ–:" deletion_report.txt | head -10 >> $GITHUB_STEP_SUMMARY || true
              fi
              
              # å®¹é‡ãŒ80%ä»¥ä¸Šã®å ´åˆã¯å®Ÿéš›ã«å‰Šé™¤
              if (( $(echo "$USAGE_PERCENT > 80" | bc -l) )); then
                echo "âš ï¸ å®¹é‡ãŒé«˜ã„ãŸã‚å®Ÿéš›ã«å‰Šé™¤ã‚’å®Ÿè¡Œ" >> $GITHUB_STEP_SUMMARY
                CI=true node scripts/maintenance/smart-deletion-manager.js >> $GITHUB_STEP_SUMMARY 2>&1 || true
              fi
            else
              echo "å®¹é‡ä½¿ç”¨çŽ‡ãŒ${USAGE_PERCENT}%ã®ãŸã‚ã€å‰Šé™¤ã¯ä¸è¦ã§ã™" >> $GITHUB_STEP_SUMMARY
            fi
          fi
          
          if [[ "$MAINTENANCE" == "all" || "$MAINTENANCE" == "optimize" ]]; then
            echo "### âš¡ Optimizing database" >> $GITHUB_STEP_SUMMARY
            node scripts/maintenance/optimize-database.js >> $GITHUB_STEP_SUMMARY 2>&1 || true
          fi
          
          if [[ "$MAINTENANCE" == "all" || "$MAINTENANCE" == "stats" ]]; then
            echo "### ðŸ“Š Updating statistics" >> $GITHUB_STEP_SUMMARY
            node scripts/maintenance/update-statistics.js >> $GITHUB_STEP_SUMMARY 2>&1 || true
          fi
          
          if [[ "$MAINTENANCE" == "all" || "$MAINTENANCE" == "rotation" ]]; then
            echo "### ðŸ”„ Rotating products" >> $GITHUB_STEP_SUMMARY
            # å¤ã„å‰Šé™¤ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ä»£ã‚ã‚Šã«ã‚¹ãƒžãƒ¼ãƒˆå‰Šé™¤ã‚’ä½¿ç”¨
            DRY_RUN=false CI=true node scripts/maintenance/smart-deletion-manager.js >> $GITHUB_STEP_SUMMARY 2>&1 || true
          fi
        env:
          EXPO_PUBLIC_SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
          EXPO_PUBLIC_SUPABASE_ANON_KEY: ${{ secrets.SUPABASE_ANON_KEY }}

      - name: ðŸš¨ Emergency capacity check
        if: always()
        run: |
          echo "## ðŸš¨ Emergency Capacity Check" >> $GITHUB_STEP_SUMMARY
          
          # ç¾åœ¨ã®å®¹é‡ã‚’å†ç¢ºèª
          node scripts/monitoring/supabase-free-tier-monitor.js > final_capacity_check.txt 2>&1 || true
          
          if [ -f final_capacity_check.txt ]; then
            FINAL_USAGE=$(grep -oP 'ä½¿ç”¨çŽ‡: \K[\d.]+' final_capacity_check.txt || echo "0")
            
            echo "æœ€çµ‚å®¹é‡ä½¿ç”¨çŽ‡: ${FINAL_USAGE}%" >> $GITHUB_STEP_SUMMARY
            
            # 90%ã‚’è¶…ãˆã¦ã„ã‚‹å ´åˆã¯ç·Šæ€¥å‰Šé™¤
            if (( $(echo "$FINAL_USAGE > 90" | bc -l) )); then
              echo "âŒ å®¹é‡ãŒå±é™ºæ°´æº–(${FINAL_USAGE}%)ã§ã™ï¼ç·Šæ€¥å‰Šé™¤ã‚’å®Ÿè¡Œ" >> $GITHUB_STEP_SUMMARY
              node scripts/maintenance/emergency-deletion.js >> $GITHUB_STEP_SUMMARY 2>&1 || true
            elif (( $(echo "$FINAL_USAGE > 80" | bc -l) )); then
              echo "âš ï¸ å®¹é‡ãŒè­¦å‘Šæ°´æº–(${FINAL_USAGE}%)ã§ã™" >> $GITHUB_STEP_SUMMARY
            else
              echo "âœ… å®¹é‡ã¯å¥å…¨(${FINAL_USAGE}%)ã§ã™" >> $GITHUB_STEP_SUMMARY
            fi
          fi
        env:
          EXPO_PUBLIC_SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
          EXPO_PUBLIC_SUPABASE_ANON_KEY: ${{ secrets.SUPABASE_ANON_KEY }}

      - name: ðŸ“Š Generate comprehensive report
        if: always()
        run: |
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "## ðŸ“Š Sync Report Summary" >> $GITHUB_STEP_SUMMARY
          
          # åŒæœŸçµæžœ
          if [ "${{ steps.sync.outcome }}" == "success" ]; then
            echo "### âœ… Sync Status: Success" >> $GITHUB_STEP_SUMMARY
          else
            echo "### âŒ Sync Status: Failed or Partial" >> $GITHUB_STEP_SUMMARY
          fi
          
          echo "" >> $GITHUB_STEP_SUMMARY
          
          # Phase 3ãƒ–ãƒ©ãƒ³ãƒ‰çµ±è¨ˆ
          echo "### ðŸ“ˆ Phase 3 Brand Categories (50-60 brands)" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          
          echo "#### ðŸŽ¯ Age Group Coverage:" >> $GITHUB_STEP_SUMMARY
          echo "- **20-24æ­³**: GU, WEGO, ZARA, H&M, DHOLIC (ãƒ—ãƒãƒ—ãƒ©ãƒ»ãƒˆãƒ¬ãƒ³ãƒ‰)" >> $GITHUB_STEP_SUMMARY
          echo "- **25-29æ­³**: coca, pierrot, fifth, PLST, vis (ã‚ªãƒ•ã‚£ã‚¹ãƒ»ãã‚Œã„ã‚)" >> $GITHUB_STEP_SUMMARY
          echo "- **30-34æ­³**: URBAN RESEARCH, BEAMS, ç„¡å°è‰¯å“, studio CLIP (è³ªé‡è¦–)" >> $GITHUB_STEP_SUMMARY
          echo "- **35-39æ­³**: ROPE', 23åŒº, nest Robe, SM2 (ä¸Šè³ªã‚«ã‚¸ãƒ¥ã‚¢ãƒ«)" >> $GITHUB_STEP_SUMMARY
          echo "- **40-45æ­³**: Theory, TOMORROWLAND, GALLARDAGALANTE (ã‚¨ãƒ¬ã‚¬ãƒ³ãƒˆ)" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          
          echo "#### ðŸ’° Price Range Distribution:" >> $GITHUB_STEP_SUMMARY
          echo "- **ãƒ—ãƒãƒ—ãƒ©** (ã€œ5,000å††): 15 brands" >> $GITHUB_STEP_SUMMARY
          echo "- **ãƒŸãƒ‰ãƒ«** (5,000ã€œ15,000å††): 20 brands" >> $GITHUB_STEP_SUMMARY
          echo "- **ãƒã‚¤ãƒŸãƒ‰ãƒ«** (15,000ã€œ30,000å††): 15 brands" >> $GITHUB_STEP_SUMMARY
          echo "- **ãƒã‚¤ãƒ–ãƒ©ãƒ³ãƒ‰** (30,000å††ã€œ): 10 brands" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          
          echo "#### ðŸ‘— Style Categories:" >> $GITHUB_STEP_SUMMARY
          echo "- **ã‚«ã‚¸ãƒ¥ã‚¢ãƒ«**: UNIQLO, GU, GAP, GLOBAL WORK" >> $GITHUB_STEP_SUMMARY
          echo "- **ã‚ªãƒ•ã‚£ã‚¹/ãã‚Œã„ã‚**: PLST, vis, ROPE', NATURAL BEAUTY BASIC" >> $GITHUB_STEP_SUMMARY
          echo "- **ãƒ•ã‚§ãƒŸãƒ‹ãƒ³**: MISCH MASCH, Apuweiser-riche, JILL STUART" >> $GITHUB_STEP_SUMMARY
          echo "- **ãƒ¢ãƒ¼ãƒ‰/å€‹æ€§æ´¾**: ZARA, COS, STUDIOUS, ENFOLD" >> $GITHUB_STEP_SUMMARY
          echo "- **ãƒŠãƒãƒ¥ãƒ©ãƒ«**: ç„¡å°è‰¯å“, studio CLIP, SM2, nest Robe" >> $GITHUB_STEP_SUMMARY
          echo "- **éŸ“å›½ç³»**: DHOLIC, 17kg, HOTPING" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          
          # ç¾åœ¨ã®çµ±è¨ˆã‚’å–å¾—
          echo "### ðŸ“Š Current Statistics" >> $GITHUB_STEP_SUMMARY
          node scripts/testing/check-current-brands.js >> $GITHUB_STEP_SUMMARY 2>&1 || echo "- Statistics unavailable" >> $GITHUB_STEP_SUMMARY
          
          echo "" >> $GITHUB_STEP_SUMMARY
          
          # æŽ¨å¥¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³
          echo "### ðŸ’¡ Next Actions" >> $GITHUB_STEP_SUMMARY
          if [ "${{ steps.sync.outcome }}" != "success" ]; then
            echo "1. Check sync logs for specific errors" >> $GITHUB_STEP_SUMMARY
            echo "2. Verify API rate limits" >> $GITHUB_STEP_SUMMARY
            echo "3. Review failed brand syncs" >> $GITHUB_STEP_SUMMARY
          else
            echo "1. Monitor user engagement by age group" >> $GITHUB_STEP_SUMMARY
            echo "2. Analyze style preference trends" >> $GITHUB_STEP_SUMMARY
            echo "3. Review seasonal product performance" >> $GITHUB_STEP_SUMMARY
            echo "4. Check brand coverage gaps" >> $GITHUB_STEP_SUMMARY
          fi

      - name: ðŸ’¾ Upload artifacts
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: unified-sync-logs-${{ github.run_id }}
          path: |
            logs/
            data/sync-history*.json
            *.log
            capacity_report.txt
          retention-days: 30
          if-no-files-found: ignore

      - name: ðŸŽ‰ Success celebration
        if: success()
        run: |
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "## ðŸŽ‰ Phase 3 Unified Sync Completed Successfully!" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### ðŸš€ Achievements:" >> $GITHUB_STEP_SUMMARY
          echo "- Successfully synchronized 50-60 brands for 20-40s women" >> $GITHUB_STEP_SUMMARY
          echo "- Covered all age groups with appropriate brand selection" >> $GITHUB_STEP_SUMMARY
          echo "- Maintained price range diversity for all budgets" >> $GITHUB_STEP_SUMMARY
          echo "- Applied seasonal optimization for current trends" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "**Target**: 50,000+ products | **Brands**: 50-60 | **Age**: 20-40s women" >> $GITHUB_STEP_SUMMARY
