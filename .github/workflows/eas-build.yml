name: EAS Build\n\non:\n  push:\n    branches: [main, develop]\n  workflow_dispatch:\n\njobs:\n  build:\n    name: Build App\n    runs-on: ubuntu-latest\n    permissions:\n      contents: write\n    steps:\n      - name: ğŸ— Setup repo\n        uses: actions/checkout@v3\n        with:\n          fetch-depth: 0 # å®Œå…¨ãªå±¥æ­´ã‚’å–å¾—\n\n      - name: ğŸ— Setup Node\n        uses: actions/setup-node@v3\n        with:\n          node-version: 18.x\n          cache: yarn\n\n      - name: ğŸ“¦ Install dependencies\n        run: yarn install --frozen-lockfile\n\n      - name: ğŸ—‘ï¸ Remove app.config.ts\n        run: rm -f app.config.ts\n\n      - name: ğŸ§¹ Clean Git state if needed\n        run: |\n          # Gitè¨­å®šã‚’è¡Œã†\n          git config --global user.name \"GitHub Action\"\n          git config --global user.email \"action@github.com\"\n          \n          # å¤‰æ›´ãŒã‚ã‚‹å ´åˆã¯ã¾ãšã‚³ãƒŸãƒƒãƒˆã™ã‚‹\n          if [[ -n $(git status --porcelain) ]]; then\n            echo \"Changes detected, committing them first...\"\n            git add -A\n            git commit -m \"Auto-commit by GitHub Actions [skip ci]\"\n          else\n            echo \"Git working directory is clean.\"\n          fi\n          \n          # ãƒªãƒ¢ãƒ¼ãƒˆã®å¤‰æ›´ã‚’å–å¾—\n          git fetch origin\n          \n          # ç¾åœ¨ã®ãƒ–ãƒ©ãƒ³ãƒåã‚’å–å¾—\n          CURRENT_BRANCH=${GITHUB_REF#refs/heads/}\n          \n          # ãƒªãƒ¢ãƒ¼ãƒˆã®å¤‰æ›´ã‚’å–ã‚Šè¾¼ã‚€\n          git pull --rebase origin $CURRENT_BRANCH || echo \"No changes to pull or rebase failed\"\n          \n          # Pull Requestã§ã¯ãªãã€ç›´æ¥pushã®å ´åˆã®ã¿pushã‚’å®Ÿè¡Œ\n          if [[ \"${{ github.event_name }}\" != \"pull_request\" && -n $(git log origin/$CURRENT_BRANCH..$CURRENT_BRANCH) ]]; then\n            echo \"Pushing changes to origin...\"\n            git push origin $CURRENT_BRANCH\n          else\n            echo \"No changes to push or Pull Requestä¸­ã®ãŸã‚å¤‰æ›´ã¯pushã›ãš\"\n          fi\n\n      - name: ğŸ— Setup EAS\n        uses: expo/expo-github-action@v8\n        with:\n          eas-version: latest\n          token: ${{ secrets.EXPO_TOKEN }}\n\n      - name: ğŸ“ Configure EAS Project\n        run: |\n          # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®çŠ¶æ…‹ã‚’ç¢ºèª\n          echo \"Checking EAS project configuration...\"\n          npx eas-cli whoami\n          \n          # å¿…è¦ã«å¿œã˜ã¦ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ç™»éŒ²/æ›´æ–°\n          npx eas-cli project:info || (\n            echo \"Project not found or not properly linked. Creating/linking project...\"\n            npx eas-cli init --id beb25e0f-344b-4f2f-8b64-20614b9744a3 --non-interactive || true\n          )\n\n      - name: ğŸš€ Build App (Android)\n        run: npx eas-cli build --platform android --profile ci --non-interactive\n\n      - name: ğŸš€ Build App (iOS)\n        run: npx eas-cli build --platform ios --profile ci --non-interactive\n