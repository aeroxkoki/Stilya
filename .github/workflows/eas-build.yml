name: EAS Build\n\non:\n  push:\n    branches: [main, develop]\n  workflow_dispatch:\n\njobs:\n  build:\n    name: Build App\n    runs-on: ubuntu-latest\n    permissions:\n      contents: write\n    steps:\n      - name: 🏗 Setup repo\n        uses: actions/checkout@v3\n        with:\n          fetch-depth: 0 # 完全な履歴を取得\n\n      - name: 🏗 Setup Node\n        uses: actions/setup-node@v3\n        with:\n          node-version: 18.x\n          cache: yarn\n\n      - name: 📦 Install dependencies\n        run: yarn install --frozen-lockfile\n\n      - name: 🗑️ Remove app.config.ts\n        run: rm -f app.config.ts\n\n      - name: 🧹 Clean Git state if needed\n        run: |\n          # Git設定を行う\n          git config --global user.name \"GitHub Action\"\n          git config --global user.email \"action@github.com\"\n          \n          # 変更がある場合はまずコミットする\n          if [[ -n $(git status --porcelain) ]]; then\n            echo \"Changes detected, committing them first...\"\n            git add -A\n            git commit -m \"Auto-commit by GitHub Actions [skip ci]\"\n          else\n            echo \"Git working directory is clean.\"\n          fi\n          \n          # リモートの変更を取得\n          git fetch origin\n          \n          # 現在のブランチ名を取得\n          CURRENT_BRANCH=${GITHUB_REF#refs/heads/}\n          \n          # リモートの変更を取り込む\n          git pull --rebase origin $CURRENT_BRANCH || echo \"No changes to pull or rebase failed\"\n          \n          # Pull Requestではなく、直接pushの場合のみpushを実行\n          if [[ \"${{ github.event_name }}\" != \"pull_request\" && -n $(git log origin/$CURRENT_BRANCH..$CURRENT_BRANCH) ]]; then\n            echo \"Pushing changes to origin...\"\n            git push origin $CURRENT_BRANCH\n          else\n            echo \"No changes to push or Pull Request中のため変更はpushせず\"\n          fi\n\n      - name: 🏗 Setup EAS\n        uses: expo/expo-github-action@v8\n        with:\n          eas-version: latest\n          token: ${{ secrets.EXPO_TOKEN }}\n\n      - name: 📝 Configure EAS Project\n        run: |\n          # プロジェクトの状態を確認\n          echo \"Checking EAS project configuration...\"\n          npx eas-cli whoami\n          \n          # 必要に応じてプロジェクトを登録/更新\n          npx eas-cli project:info || (\n            echo \"Project not found or not properly linked. Creating/linking project...\"\n            npx eas-cli init --id beb25e0f-344b-4f2f-8b64-20614b9744a3 --non-interactive || true\n          )\n\n      - name: 🚀 Build App (Android)\n        run: npx eas-cli build --platform android --profile ci --non-interactive\n\n      - name: 🚀 Build App (iOS)\n        run: npx eas-cli build --platform ios --profile ci --non-interactive\n