# Stilya データ整合性管理ドキュメント

## 概要
このドキュメントは、Stilyaプロジェクトのコードとデータベース間の整合性を管理するためのガイドラインです。

## 統一された定義

### 1. スタイル定義（✅ 2025年7月16日 統一完了）
- **変更前**: 「きれいめ」
- **変更後**: 「クラシック」
- **影響範囲**: 
  - コード: すべて修正済み
  - データベース: 6,689件を更新済み
- **後方互換性**: `JP_TAG_TO_STYLE_ID`にエイリアスを追加

### 2. 年代区分（✅ 2025年7月16日 修正完了）
- **問題**: `constants.ts`で`fifties`、他で`fifties_plus`
- **修正**: すべて`fifties_plus`に統一
- **影響範囲**: `constants.ts`のAGE_GROUPS定義

### 3. 価格帯タグ（🔧 要対応）
- **現状**: 
  - 「お手頃」: 12,596件
  - 「プチプラ」: 7,309件
  - 両方を持つ商品: 2,649件
- **推奨**: 「プチプラ」→「お手頃」に統一
- **スクリプト**: `scripts/update_price_tags.sql`

### 4. スタイルタグ（🔍 検討中）
- **現状**:
  - 「シンプル」: 2,737件
  - 「ミニマル」: 3,013件
  - 両方を持つ商品: 2,736件（ほぼ全て）
- **検討**: 統一の必要性を評価中

## 定数定義の中央集権化

### `src/constants/constants.ts`
すべての共通定義を管理：
- `FASHION_STYLES`: スタイル定義
- `STYLE_ID_TO_JP_TAG`: IDから日本語へのマッピング
- `JP_TAG_TO_STYLE_ID`: 日本語からIDへのマッピング
- `STYLE_TAG_MAPPING`: スタイルと関連タグ
- `FILTER_STYLE_OPTIONS`: フィルター用オプション
- `AGE_GROUPS`: 年代区分
- `GENDER_TYPES`: 性別区分
- `PRODUCT_CATEGORIES`: 商品カテゴリ

## データベース更新手順

### 1. バックアップの作成
```bash
# Supabaseダッシュボードから、またはpg_dumpを使用
```

### 2. 更新スクリプトの実行
```sql
-- トランザクション内で実行
BEGIN;
-- スクリプトの内容
COMMIT; -- 問題なければ
-- ROLLBACK; -- 問題があれば
```

### 3. 動作確認
- アプリケーションの動作テスト
- フィルター機能の確認
- レコメンデーション精度の確認

## 今後の改善点

1. **自動整合性チェック**: CI/CDパイプラインに整合性チェックを追加
2. **タグ管理システム**: 新規タグ追加時の承認フロー
3. **定期的な重複チェック**: 類似タグの自動検出

## 更新履歴

- 2025年7月16日: 「きれいめ」→「クラシック」統一
- 2025年7月16日: 年代区分`fifties`→`fifties_plus`修正
- （予定）価格帯タグの統一

## 関連ファイル

- `/src/constants/constants.ts`: 中央定義ファイル
- `/scripts/update_style_tags.sql`: スタイルタグ更新スクリプト
- `/scripts/update_price_tags.sql`: 価格帯タグ更新スクリプト
