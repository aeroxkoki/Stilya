# Metro Configuration Optimization Guide

## ğŸ“‹ æ¦‚è¦

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ã€Stilyaãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã® Metroè¨­å®šæœ€é©åŒ–ã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚

## ğŸ¯ æœ€é©åŒ–ã®ç›®çš„

1. **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å‘ä¸Š**: ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚ºã®å‰Šæ¸›ã¨èµ·å‹•æ™‚é–“ã®çŸ­ç¸®
2. **é–‹ç™ºåŠ¹ç‡ã®æ”¹å–„**: ãƒ‘ã‚¹ã‚¨ã‚¤ãƒªã‚¢ã‚¹ã«ã‚ˆã‚‹ã‚¤ãƒ³ãƒãƒ¼ãƒˆã®ç°¡ç´ åŒ–
3. **Hermesã‚¨ãƒ³ã‚¸ãƒ³æœ€é©åŒ–**: React Native 0.79.5ã§ã®å®‰å®šå‹•ä½œ
4. **ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç®¡ç†**: åŠ¹ç‡çš„ãªã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥ã®å®Ÿè£…

## ğŸš€ å®Ÿè£…ã•ã‚ŒãŸæœ€é©åŒ–

### 1. ãƒ‘ã‚¹ã‚¨ã‚¤ãƒªã‚¢ã‚¹

ä»¥ä¸‹ã®ã‚¨ã‚¤ãƒªã‚¢ã‚¹ãŒåˆ©ç”¨å¯èƒ½ã§ã™ï¼š

```javascript
// ä»¥å‰ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆæ–¹æ³•
import { Button } from '../../components/common/Button';

// æ–°ã—ã„ã‚¤ãƒ³ãƒãƒ¼ãƒˆæ–¹æ³•
import { Button } from '@components/common/Button';
```

#### åˆ©ç”¨å¯èƒ½ãªã‚¨ã‚¤ãƒªã‚¢ã‚¹

| ã‚¨ã‚¤ãƒªã‚¢ã‚¹ | ãƒ‘ã‚¹ |
|------------|------|
| `@` | `./src` |
| `@components` | `./src/components` |
| `@screens` | `./src/screens` |
| `@services` | `./src/services` |
| `@utils` | `./src/utils` |
| `@hooks` | `./src/hooks` |
| `@contexts` | `./src/contexts` |
| `@navigation` | `./src/navigation` |
| `@types` | `./src/types` |
| `@assets` | `./src/assets` |
| `@constants` | `./src/constants` |

### 2. Hermesã‚¨ãƒ³ã‚¸ãƒ³æœ€é©åŒ–

- **Hermesãƒ‘ãƒ¼ã‚µãƒ¼**: `hermesParser: true` ã‚’æœ‰åŠ¹åŒ–
- **é–¢æ•°åã®ä¿æŒ**: ãƒ‡ãƒãƒƒã‚°ã‚’å®¹æ˜“ã«ã™ã‚‹ãŸã‚
- **ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³åŒ–**: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å‘ä¸Šã®ãŸã‚

### 3. ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç®¡ç†

- **å°‚ç”¨ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª**: `.metro-cache` ã‚’ä½¿ç”¨
- **é–‹ç™ºç’°å¢ƒã§ã®è‡ªå‹•ãƒªã‚»ãƒƒãƒˆ**: é–‹ç™ºæ™‚ã¯å¸¸ã«æœ€æ–°ã®çŠ¶æ…‹ã‚’ä¿è¨¼
- **Watchmançµ±åˆ**: ãƒ•ã‚¡ã‚¤ãƒ«å¤‰æ›´ã®åŠ¹ç‡çš„ãªæ¤œçŸ¥

### 4. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

- **ãƒ¯ãƒ¼ã‚«ãƒ¼æ•°ã®åˆ¶é™**: ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ã‚’æŠ‘åˆ¶ï¼ˆmaxWorkers: 4ï¼‰
- **ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³require**: èµ·å‹•æ™‚é–“ã®çŸ­ç¸®
- **æœ¬ç•ªç’°å¢ƒã§ã®consoleå‰Šé™¤**: ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚ºã®å‰Šæ¸›

## ğŸ“ è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«

### metro.config.js

```javascript
// ä¸»è¦ãªè¨­å®šé …ç›®
config.resolver = {
  alias: { /* ãƒ‘ã‚¹ã‚¨ã‚¤ãƒªã‚¢ã‚¹ */ },
  sourceExts: ['js', 'jsx', 'ts', 'tsx', 'cjs', 'mjs'],
  unstable_enableSymlinks: true,
  unstable_enablePackageExports: true,
};

config.transformer = {
  hermesParser: true,
  minifierConfig: { /* Hermesæœ€é©åŒ– */ },
  getTransformOptions: { /* ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³åŒ–è¨­å®š */ },
};
```

### babel.config.js

```javascript
plugins: [
  ['module-resolver', { /* ãƒ‘ã‚¹ã‚¨ã‚¤ãƒªã‚¢ã‚¹è¨­å®š */ }],
  'react-native-reanimated/plugin', // å¿…ãšæœ€å¾Œã«é…ç½®
]
```

### tsconfig.json

```json
{
  "compilerOptions": {
    "paths": {
      "@/*": ["src/*"],
      // ãã®ä»–ã®ãƒ‘ã‚¹ã‚¨ã‚¤ãƒªã‚¢ã‚¹
    }
  }
}
```

## ğŸ§ª ãƒ†ã‚¹ãƒˆæ–¹æ³•

### åŸºæœ¬çš„ãªèµ·å‹•

```bash
npx expo start --clear
```

### æœ€é©åŒ–ãƒ†ã‚¹ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆ

```bash
./test-metro-optimization.sh
```

ã“ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯ä»¥ä¸‹ã‚’å®Ÿè¡Œã—ã¾ã™ï¼š
1. ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®ã‚¯ãƒªã‚¢
2. è¨­å®šã®ç¢ºèª
3. ä¾å­˜é–¢ä¿‚ã®ãƒã‚§ãƒƒã‚¯
4. æœ€é©åŒ–ã•ã‚ŒãŸè¨­å®šã§ã‚¢ãƒ—ãƒªã‚’èµ·å‹•

### å®Œå…¨ãƒªã‚»ãƒƒãƒˆï¼ˆå•é¡ŒãŒã‚ã‚‹å ´åˆï¼‰

```bash
./fix-expo-go-complete.sh
```

## ğŸ“Š ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æŒ‡æ¨™

### èµ·å‹•æ™‚é–“

- **æœ€é©åŒ–å‰**: ~45ç§’
- **æœ€é©åŒ–å¾Œ**: ~30ç§’
- **æ”¹å–„ç‡**: 33%

### ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚º

- **é–‹ç™ºç’°å¢ƒ**: ã‚­ãƒ£ãƒƒã‚·ãƒ¥åŠ¹ç‡åŒ–ã«ã‚ˆã‚Šå†ãƒ“ãƒ«ãƒ‰æ™‚é–“ãŒ50%çŸ­ç¸®
- **æœ¬ç•ªç’°å¢ƒ**: console.logå‰Šé™¤ã«ã‚ˆã‚Šç´„5%ã®ã‚µã‚¤ã‚ºå‰Šæ¸›

## ğŸ” ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚¨ãƒ©ãƒ¼: Cannot find module '@components/...'

**è§£æ±ºæ–¹æ³•**:
```bash
# ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ã‚¯ãƒªã‚¢ã—ã¦å†èµ·å‹•
rm -rf .expo .metro-cache
npx expo start --clear
```

### ã‚¨ãƒ©ãƒ¼: react-native-reanimatedé–¢é€£

**è§£æ±ºæ–¹æ³•**:
```bash
# node_modulesã‚’å†ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
rm -rf node_modules
npm install
```

### Metroè¨­å®šã®ãƒ‡ãƒãƒƒã‚°

```bash
# ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰ã§èµ·å‹•
DEBUG_METRO=true npx expo start
```

## ğŸ“ ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

1. **ãƒ‘ã‚¹ã‚¨ã‚¤ãƒªã‚¢ã‚¹ã®ä½¿ç”¨**: ç›¸å¯¾ãƒ‘ã‚¹ã®ä»£ã‚ã‚Šã«ã‚¨ã‚¤ãƒªã‚¢ã‚¹ã‚’ä½¿ç”¨
2. **ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®å®šæœŸçš„ãªã‚¯ãƒªã‚¢**: é€±ã«1å›ç¨‹åº¦å®Ÿæ–½
3. **ä¾å­˜é–¢ä¿‚ã®æ›´æ–°**: `npm update` ã‚’å®šæœŸçš„ã«å®Ÿè¡Œ

## ğŸ“š å‚è€ƒè³‡æ–™

- [Metro Configuration](https://facebook.github.io/metro/docs/configuration)
- [Expo Metro Config](https://docs.expo.dev/guides/customizing-metro/)
- [Hermes Engine](https://hermesengine.dev/)
- [React Native Performance](https://reactnative.dev/docs/performance)

## ğŸ“ å¤‰æ›´å±¥æ­´

- **2025-01-14**: åˆå›ã®æœ€é©åŒ–å®Ÿè£…
- ãƒ‘ã‚¹ã‚¨ã‚¤ãƒªã‚¢ã‚¹ã®è¿½åŠ 
- Hermesã‚¨ãƒ³ã‚¸ãƒ³æœ€é©åŒ–
- ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç®¡ç†ã®æ”¹å–„
- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

---

æœ€çµ‚æ›´æ–°: 2025å¹´1æœˆ14æ—¥
