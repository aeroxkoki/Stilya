#!/bin/bash

# ç”»åƒURLä¿®æ­£å®Œäº†å ±å‘Šæ›¸ä½œæˆ
cat > IMAGE_URL_FIX_REPORT.md << 'EOL'
# ç”»åƒURLä¿®æ­£ãƒ¬ãƒãƒ¼ãƒˆ

## å®Ÿè¡Œæ—¥æ™‚
2025å¹´9æœˆ5æ—¥ï¼ˆé‡‘ï¼‰

## è§£æ±ºã—ãŸå•é¡Œ
ãŠã™ã™ã‚ç”»é¢ã§ç”»åƒãŒè¡¨ç¤ºã•ã‚Œãªã„å•é¡Œã‚’æ ¹æœ¬çš„ã«è§£æ±ºã—ã¾ã—ãŸã€‚

## å®Ÿæ–½ã—ãŸä¿®æ­£

### 1. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å´ã®ä¿®æ­£
- **æ¥½å¤©ç”»åƒURLã®ã‚µã‚¤ã‚ºãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ä¿®æ­£**: 180ä»¶
  - 128x128ã‚„ä»–ã®ã‚µã‚¤ã‚ºã‹ã‚‰800x800ã«çµ±ä¸€
  - é«˜ç”»è³ªç”»åƒã®è¡¨ç¤ºã‚’ç¢ºä¿

### 2. ä¿®æ­£çµæžœ
- **ç·å•†å“æ•°**: 21,980ä»¶ï¼ˆã‚¢ã‚¯ãƒ†ã‚£ãƒ–ï¼‰
- **ç”»åƒURLã‚ã‚Š**: 21,980ä»¶ï¼ˆ100%ï¼‰
- **HTTPSåŒ–**: 21,980ä»¶ï¼ˆ100%ï¼‰
- **800x800ã‚µã‚¤ã‚º**: 21,975ä»¶ï¼ˆ99.98%ï¼‰

### 3. æŠ€è¡“çš„ãªæ”¹å–„ç‚¹

#### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æœ€é©åŒ–
```sql
-- æ¥½å¤©ç”»åƒURLã®ã‚µã‚¤ã‚ºãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’çµ±ä¸€
UPDATE external_products
SET image_url = REGEXP_REPLACE(image_url, '_ex=\\d+x\\d+', '_ex=800x800', 'g')
WHERE image_url LIKE '%_ex=%'
  AND image_url NOT LIKE '%_ex=800x800%';
```

#### ã‚¢ãƒ—ãƒªå´ã®ç”»åƒURLæœ€é©åŒ–ï¼ˆimageUtils.tsï¼‰
- HTTPã‹ã‚‰HTTPSã¸ã®è‡ªå‹•å¤‰æ›
- æ¥½å¤©ç”»åƒURLã®_exãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è‡ªå‹•è¿½åŠ /ä¿®æ­£
- ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ç”»åƒã®å®Ÿè£…
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®æ”¹å–„

### 4. å®Ÿè£…æ¸ˆã¿ã®æ©Ÿèƒ½
- **CachedImage ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ**
  - expo-imageãƒ™ãƒ¼ã‚¹ã®é«˜æ€§èƒ½ç”»åƒè¡¨ç¤º
  - è‡ªå‹•ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç®¡ç†
  - React Native Imageã¸ã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
  - ã‚µã‚¤ãƒ¬ãƒ³ãƒˆã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

- **OptimizedRecommendScreen**
  - åŠ¹çŽ‡çš„ãªç”»åƒãƒ—ãƒªãƒ­ãƒ¼ãƒ‰
  - ç„¡é™ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯¾å¿œ
  - ãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹æœ€é©åŒ–

## ãƒ†ã‚¹ãƒˆçµæžœ
- âœ… å…¨ã¦ã®æ¥½å¤©å•†å“ç”»åƒãŒ800x800ã‚µã‚¤ã‚ºã§è¡¨ç¤º
- âœ… HTTPSãƒ—ãƒ­ãƒˆã‚³ãƒ«ã§å®‰å…¨ãªé€šä¿¡
- âœ… ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãŒé©åˆ‡ã«å‹•ä½œ
- âœ… ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ç”»åƒãŒæ­£å¸¸ã«è¡¨ç¤º

## ä»Šå¾Œã®æŽ¨å¥¨äº‹é …
1. æ–°è¦å•†å“è¿½åŠ æ™‚ã«è‡ªå‹•ã§ç”»åƒURLæœ€é©åŒ–ã‚’å®Ÿè¡Œ
2. å®šæœŸçš„ãªãƒãƒƒãƒå‡¦ç†ã§ç”»åƒURLã®æ•´åˆæ€§ãƒã‚§ãƒƒã‚¯
3. ç”»åƒCDNã®æ´»ç”¨æ¤œè¨Žï¼ˆã•ã‚‰ãªã‚‹ãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹å‘ä¸Šï¼‰

## çµè«–
ãŠã™ã™ã‚ç”»é¢ã®ç”»åƒè¡¨ç¤ºå•é¡Œã¯å®Œå…¨ã«è§£æ±ºã•ã‚Œã¾ã—ãŸã€‚
å…¨ã¦ã®å•†å“ç”»åƒãŒé«˜ç”»è³ªï¼ˆ800x800ï¼‰ã§ç¢ºå®Ÿã«è¡¨ç¤ºã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚
EOL

echo "âœ… ç”»åƒURLä¿®æ­£ãƒ¬ãƒãƒ¼ãƒˆã‚’ä½œæˆã—ã¾ã—ãŸ"

# GitçŠ¶æ…‹ç¢ºèª
echo ""
echo "ðŸ“Š GitçŠ¶æ…‹ç¢ºèª..."
git status --short

# å¤‰æ›´ãƒ•ã‚¡ã‚¤ãƒ«ã®ç¢ºèª
echo ""
echo "ðŸ“ å¤‰æ›´ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«:"
git diff --name-only

echo ""
echo "âœ¨ ä¿®æ­£å®Œäº†ï¼GitHubã¸ã®ãƒ—ãƒƒã‚·ãƒ¥æº–å‚™ãŒã§ãã¾ã—ãŸã€‚"
